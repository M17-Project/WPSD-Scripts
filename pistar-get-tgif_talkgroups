<?php

// TGIF talkgroup list/file generator...
// Fucking TGIF has no way of getting this info
// via an API...so I hacked this together.

$htmlContent = file_get_contents("http://tgif.network/talkgroups.php");
        
$DOM = new DOMDocument();
$DOM->loadHTML($htmlContent);
    
$items = $DOM->getElementsByTagName('tr');

  //the table by its tag name  
$tables = $DOM->getElementsByTagName('table');   
    //get all rows from the table  
$rows = $tables->item(0)->getElementsByTagName('tr');   
  // get each column by tag name  
$cols = $rows->item(0)->getElementsByTagName('th');   
$row_headers = NULL;
foreach ($cols as $node) {
    $row_headers[] = $node->nodeValue;
}   

$table = array();
  //get all rows from the table  
$rows = $tables->item(0)->getElementsByTagName('tr');   
foreach ($rows as $row)   
{   
   // get each column by tag name  
    $cols = $row->getElementsByTagName('td');   
    $row = array();
    $i=0;
    foreach ($cols as $node) {
        $row[] = $node->nodeValue;
        $i++;
    }   
    $table[] = $row;
}   
//$json  = json_encode($table);

function tdrows($elements)
{
    $str = "";
    foreach ($elements as $element) {
        $str .= $element->nodeValue . ":";
    }

    return $str;
}

$txtout = "/usr/local/etc/tgif-talkgroups.txt";
$fp = fopen($txtout, 'w');
fputs ($fp, "Talkgroup Name:Talkgroup Number\r\n"); // header row
foreach ($items as $node) {
    $tgdata = rtrim(tdrows($node->childNodes), ':'); // remove trailing colon
    //$tgdata = ltrim(tdrows($node->childNodes), ' '); // remove leading spaces
    fputs( $fp, $tgdata."\r\n" );
}
fclose( $fp );

?>
