#!/bin/bash

checkDashUpdate() {
    gitFolder="/var/www/dashboard"
    gitRemoteVer=/etc/.W0CHP-PiStar-Dash.remote_version
    # W0CHP has more than one branch. So depending on what W0CHP branch the user has installed, check that branch.
    gitBranch="$( git --git-dir=${gitFolder}/.git branch | grep '*' | awk {'print $2'} )"
    gitStatusRemote=$( cat ${gitRemoteVer} )
    gitStatusLocal=$( git --work-tree=${gitFolder} --git-dir=${gitFolder}/.git rev-parse ${dashBranch} HEAD | tail -1 | awk '{ print substr($1,1,10) }' ) # last pipe to awk: converts long hash to 10 chars.

    if [[ ${gitStatusRemote} != ${gitStatusLocal} ]]; then
        echo "1"
    else
        echo "0"
    fi
}

if [[ $(checkDashUpdate ${gitFolder}) -gt 0 ]]; then
  echo '<br /><a href="/admin/update.php"><span style="font-weight:bold;text-decoration:underline;color:#ffffff;">(Update Available)</span></a>'
fi
